<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>VTA - My-Courses</title>

  <!-- Stylesheets -->
  <link href="css/bootstrap.css" rel="stylesheet" />
  <link href="css/style.css" rel="stylesheet" />
  <link href="css/responsive.css" rel="stylesheet" />

  <link rel="shortcut icon" href="images/favicon.png" type="image/x-icon" />
  <link rel="icon" href="images/favicon.png" type="image/x-icon" />
  <script src="https://cdn.jsdelivr.net/npm/appwrite@13.0.0"></script>

  <!-- Responsive -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
  <!--[if lt IE 9
      ]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script
    ><![endif]-->
  <!--[if lt IE 9]><script src="js/respond.js"></script><![endif]-->
</head>

<body>
  <div class="page-wrapper">
    <!-- Preloader -->
    <div class="preloader"></div>

    <!-- Header Span -->
    <span class="header-span"></span>

    <!-- Main Header-->

    <header class="main-header">
      <div class="container-fluid">
        <!-- Main box -->
        <div class="main-box">
          <!--Nav Outer -->
          <div class="nav-outer">
            <div class="logo-box">
              <div class="logo">
                <a href="index.html"><img src="images/VTA-logo.png" style="width: 60%; margin-bottom: 5px;"
                    alt="VTA Logo" title="VTA"></a>
              </div>
            </div>

            <nav class="nav main-menu">
              <ul class="navigation" id="navbar">
                <li><a href="index.html">Home</a></li>
                <li><a href="about.html">About</a></li>
                <li><a href="jobs.html">Jobs</a></li>
                <li><a href="companies.html">Companies</a></li>
                <li class="current"><a href="courses.html">Courses</a></li>
              </ul>
            </nav>
          </div>

          <div class="outer-box">
            <!-- Login/Register OR User Dropdown -->
            <div class="btn-box" id="authContainer">
              <!-- Login/Register buttons will be shown here if not logged in -->
              <!-- User Dropdown will be shown here if logged in -->
            </div>
          </div>
        </div>
      </div>

      <!-- Mobile Header -->
      <div class="mobile-header">
        <div class="logo">
          <a href="index.html"><img src="images/VTA-logo.png" style="width: 60%; margin-bottom: 5px;"
              alt="VTA Logo"></a>
        </div>
        <div class="nav-outer clearfix">
          <div class="outer-box">
            <div class="login-box">
              <a href="login-popup.html" class="call-modal"><span class="icon-user"></span></a>
            </div>
            <a href="#nav-mobile" class="mobile-nav-toggler navbar-trigger"><span class="flaticon-menu-1"></span></a>
          </div>
        </div>
      </div>

      <!-- Mobile Nav -->
      <div id="nav-mobile">
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="about.html">About</a></li>
          <li><a href="jobs.html">Jobs</a></li>
          <li><a href="companies.html">Companies</a></li>
          <li><a href="courses.html">Courses</a></li>
          <li><a href="contact.html">Contact</a></li>
        </ul>
      </div>
    </header>

    <!-- JavaScript to Handle Login State -->
    <script>
      // Initialize Appwrite Client
      const client = new Appwrite.Client();
      const account = new Appwrite.Account(client);

      client
        .setEndpoint("https://cloud.appwrite.io/v1") // Replace with your Appwrite endpoint
        .setProject("67dd08bb00338a6cdf8b"); // Replace with your Appwrite project ID

      // Function to Check If User is Logged In
      async function checkLoginStatus() {
        try {
          const user = await account.get(); // Get current session
          showUserDropdown(user); // If session exists, show account menu
        } catch (error) {
          showLoginButtons(); // If no session, show Register/Login buttons
        }
      }

      // Show "My Account" Dropdown if Logged In
      function showUserDropdown(user) {
        document.getElementById("authContainer").innerHTML = `
          <div class="dropdown dashboard-option">
            <a class="dropdown-toggle" role="button" data-toggle="dropdown" aria-expanded="false">
              <img src="images/background/image.png" alt="avatar" class="thumb" />
              <span class="name">${user.name || "My Account"}</span>
            </a>
            <ul class="dropdown-menu">
              <li><a href="profile.html"><i class="fa fa-user"></i> Profile</a></li>
              <li><a href="my-courses.html"><i class="fa fa-book"></i> My Courses</a></li>
              <li><a href="account.html"><i class="fa fa-cog"></i> Settings</a></li>
              <li><a href="#" onclick="logout()"><i class="fa fa-sign-out"></i> Logout</a></li>
            </ul>

          </div>
        `;
      }

      // Show Register/Login Buttons if Not Logged In
      function showLoginButtons() {
        document.getElementById("authContainer").innerHTML = `
          <a href="register.html" class="home21-jp-btn login-btn bdrs30">Register</a>
          <a href="login.html" class="home21-jp-btn login-btn bdrs30">Login</a>
        `;
      }

      // Logout Function
      async function logout() {
        try {
          await account.deleteSession("current"); // Log out from Appwrite
          window.location.href = "index.html"; // Redirect to home page
        } catch (error) {
          console.error("Logout failed:", error.message);
        }
      }

      // Run Login Check When Page Loads
      document.addEventListener("DOMContentLoaded", checkLoginStatus);
    </script>



    <div class="container" id="course-container">
      <div class="course-header">
        <p class="sub-title">ENROLLED COURSES <span></span></p>

      </div>

      <div class="course-container" id="course-list"></div>

      <div class="pagination">
        <button id="prev-btn" onclick="prevPage()">Previous</button>
        <span id="page-number"></span>
        <button id="next-btn" onclick="nextPage()">Next</button>
      </div>
    </div>

    <script type="module">
      import { Client, Databases, Account } from "https://cdn.jsdelivr.net/npm/appwrite@11.0.0/+esm";

      client.setEndpoint("https://cloud.appwrite.io/v1").setProject("67dd08bb00338a6cdf8b");

      const database = new Databases(client);


      let currentPage = 1;
      const coursesPerPage = 4;

      async function fetchEnrolledCourses() {
        try {
          // Get logged-in user
          const user = await account.get();
          const userId = user.$id;

          // Fetch user's enrollment document (Document ID = user ID)
          const userEnrollment = await database.getDocument(
            "67dd1d13000b5edf92bb", // Database ID
            "67dd1d360022aa3123c1", // Enrollment Collection ID
            userId // Document ID (same as user ID)
          );

          let enrolledCourses = userEnrollment.coursesCollection;

          if (!Array.isArray(enrolledCourses) || enrolledCourses.length === 0) {
            document.getElementById("course-container").innerHTML = "<p>You have not enrolled in any courses yet.</p>";
            return;
          }

          renderCourses(enrolledCourses);
        } catch (error) {
          console.error("Error fetching enrolled courses:", error);
        }
      }

      function renderCourses(courses) {
        const start = (currentPage - 1) * coursesPerPage;
        const end = start + coursesPerPage;
        const paginatedCourses = courses.slice(start, end);

        const courseContainer = document.getElementById("course-list");
        courseContainer.innerHTML = "";

        paginatedCourses.forEach(course => {
          const courseCard = document.createElement("div");
          courseCard.classList.add("course-card");
          courseCard.id = `course-${course.$id}`;

          courseCard.innerHTML = `
        <a href="coursedetail.html?id=${course.$id}" class="course-link">
          <img src="${course.imageurl}" alt="${course.CourseName}">
          <div class="course-info">
            <h3 class="course-title">${course.CourseName}</h3>
          </div>
        </a>
        <div class="course-actions">
          <span class="enroll-btn">₹${course.Price}</span>
          <span><i class="fas fa-clock"></i> ${course.Duration} Hours</span>
          <span><i class="fas fa-star"></i> ${course.Rating}</span>
          <button class="remove-btn" data-course-id="${course.$id}">
          Un Enroll
        </button>
        </div>
      `;

          courseContainer.appendChild(courseCard);
        });

        document.getElementById("page-number").innerText = `Page ${currentPage} of ${Math.ceil(courses.length / coursesPerPage)}`;
        document.getElementById("prev-btn").disabled = currentPage === 1;
        document.getElementById("next-btn").disabled = currentPage === Math.ceil(courses.length / coursesPerPage);
        document.querySelectorAll(".remove-btn").forEach(button => {
        button.addEventListener("click", async (event) => {
          const courseId = event.target.getAttribute("data-course-id");
          //console.log(courseId)
          await removeEnrollment(courseId);
        });
      });
      }
      

      async function removeEnrollment(courseId) {
        try {
          // Get logged-in user
          const user = await account.get();
          const userId = user.$id;

          // Fetch user enrollment document
          const userEnrollment = await database.getDocument(
            "67dd1d13000b5edf92bb", // Database ID
            "67dd1d360022aa3123c1", // Enrollment Collection ID
            userId // Document ID (same as user ID)
          );
          

          // Remove course ID from coursesCollection array
          let updatedCourses = userEnrollment.coursesCollection.filter(c => c.$id !== courseId);
          console.log(updatedCourses)

          // Update user's enrollment document
          await database.updateDocument(
            "67dd1d13000b5edf92bb", // Database ID
            "67dd1d360022aa3123c1", // Enrollment Collection ID
            userId, // Document ID (same as user ID)
            { coursesCollection: updatedCourses }
          );

          // Remove the course from the UI
          document.getElementById(`course-${courseId}`).remove();
          alert("Course unenrolled successfully.");
        } catch (error) {
          console.error("Error removing enrollment:", error);
          alert("Failed to remove course enrollment. Please try again.");
        }
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          fetchEnrolledCourses();
        }
      }

      function nextPage() {
        currentPage++;
        fetchEnrolledCourses();
      }

      fetchEnrolledCourses();
    </script>

    <style>
      body {
        margin: 0;
        padding: 0;
        background: #f4f4f4;
      }

      .course-container {
        width: 100%;
        max-width: 1300px;
        margin: auto;
        padding: 20px;
        display: flex;
        flex-wrap: wrap;
        justify-content: space-between;
        gap: 30px;
      }

      .course-card {
        width: calc(33.33% - 20px);
        /* 3 cards per row */
        background: white;
        box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #f1caff;
        border-radius: 10px;
        text-align: left;
        position: relative;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }

      .course-card:hover {
        transform: translateY(-5px);
        box-shadow: 0px 6px 12px rgba(0, 0, 0, 0.15);
      }

      .course-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
        border-radius: 10px 10px 0 0;
      }

      .course-category {
        position: absolute;
        top: 10px;
        left: 10px;
        background: linear-gradient(to right, #a64eee 0%, #3c35ce 100%);
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-weight: bold;
        font-size: 12px;
      }

      .course-title {
        font-size: 18px;

        font-weight: bold;
        color: #333;
      }

      .course-info {
        padding: 10px;
        font-size: 14px;
        color: #666;
        margin: 0 10px;
      }

      .course-actions span i {
        color: #a64eee;
      }

      /* Buttons Section */
      .course-actions {
        display: flex;
        align-items: center;
        justify-content: space-evenly;
        /* Aligns buttons to the right */
        gap: 10px;
        margin: 0px 10px;
        padding-bottom: 10px;

      }

      .enroll-btn {
        border: 2px solid #a64eee;
        background: transparent;
        color: #a64eee;
        padding: 8px 15px;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
      }

      .enroll-btn:hover {
        background: #a64eee;
        color: white;
      }

      .cart-btn {
        background: linear-gradient(to left, #a64eee 0%, #3c35ce 100%);
        color: white;
        border: none;
        padding: 8px 15px;
        font-size: 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        border-radius: 5px;
        transition: all 0.3s ease;
      }

      .cart-btn:hover {
        opacity: 0.9;
      }

      .enroll-btn i,
      .cart-btn i {
        font-size: 16px;
      }


      /* Pagination */
      .pagination {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
      }

      #page-number {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        min-width: 120px;
        text-align: center;
      }

      .pagination button {
        background: linear-gradient(to left, #a64eee 0%, #3c35ce 100%);
        color: white;
        border: none;
        padding: 5px 15px;
        cursor: pointer;
        border-radius: 5px;
        font-size: 16px;
        transition: 0.3s ease;
        margin-bottom: 20px;
      }

      .pagination button:hover {
        background: linear-gradient(to right, #a64eee 0%, #3c35ce 100%);
      }

      .pagination button:disabled {
        background: #ccc;
        cursor: not-allowed;
      }

      /* Header Section */
      .course-header {
        text-align: left;
        margin: 40px 0;
      }

      .sub-title {
        font-size: 14px;
        color: #a64eee;
        font-weight: bold;
        letter-spacing: 1px;
        position: relative;
        display: inline-block;
      }

      .sub-title span {
        display: inline-block;
        width: 50px;
        height: 2px;
        background: #3c35ce;
        position: absolute;
        top: 50%;
        margin-left: 10px;
      }

      .remove-btn {
        background: #dc3545;
        color: white;
        padding: 8px 12px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .remove-btn:hover {
        background: #b52a37;
      }

      .course-header h2 {
        font-size: 32px;
        font-weight: bold;
        color: #1d3557;
        margin: 5px 0;
      }

      .highlight {
        color: #a64eee;
        text-decoration: underline;
        text-underline-offset: 4px;
        text-decoration-thickness: 2px;
      }

      /* Responsive Design */
      @media (max-width: 1024px) {
        .course-card {
          width: calc(50% - 20px);
          /* 2 cards per row */
        }
      }

      @media (max-width: 767px) {
        .course-card {
          width: 100%;
          /* 1 card per row */
        }

        .course-actions {
          justify-content: center;
          /* Align buttons center on mobile */
        }
      }
    </style>










    <!-- Font Awesome for Icons -->
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>



    <!--End Main Header -->

    <!-- Sidebar Backdrop -->


    <!-- User Sidebar
    <div class="user-sidebar">
      <div class="sidebar-inner">
        <ul class="navigation">
          <li class="active"><a href="courses.html"><i class="fas fa-home"></i> Dashboard</a></li>
          <li><a href="courses-allcourse.html"><i class="fas fa-book"></i> All Courses</a></li>
          <li><a href="course-enrolled.html"><i class="fas fa-user-graduate"></i>My Courses</a></li>
        
          <li><a href="completedcourses.html"><i class="fas fa-check-circle"></i> Completed</a></li>
          <li><a href="mycart.html"><i class="fas fa-shopping-cart"></i>My wishlist</a></li>
          <li><a href="Learning-path.html"><i class="fas fa-chalkboard-teacher"></i>Learning Path</a></li>
        </ul>
        
      </div>
    </div> -->


    <!-- End User Sidebar -->

    <!-- Dashboard -->




    <!-- Copyright -->
    <!-- <div class="copyright-text"> -->

    <!-- </div> -->

  </div><!-- End Page Wrapper -->



  <footer class="main-footer alternate5">
    <div class="auto-container">
      <!--Widgets Section-->
      <div class="widgets-section">
        <div class="row">
          <div class="big-column col-xl-4 col-lg-3 col-md-12">
            <div class="footer-column about-widget">
              <div class="logo">
                <a href="#"><img src="images/VTA-logo.png" style="width: 60%; margin-bottom: 5px;" alt="" /></a>
              </div>
              <p class="phone-num">
                <span>Call us </span><a href="thebeehost@support.com">1 (314) 732 0300</a><br />
                <a href="thebeehost@support.com">+91 96000 85988</a>
              </p>
              <p class="address">
                Akshaya HQ, Rajiv Gandhi Salai, Kazhipattur,<br />
                Tamil Nadu, Chennai - 603103, India. <br />
              <p class="address">
                1401, 21st ST STE 6310,<br />
                Sacramento, CA 95811, USA.
              </p>
              <a href="mailto:support@infoziant.com" class="email">support@infoziant.com</a>
              </p>
            </div>
          </div>

          <div class="big-column col-xl-8 col-lg-9 col-md-12">
            <div class="row">
              <div class="footer-column col-lg-3 col-md-6 col-sm-12">
                <div class="footer-widget links-widget">
                  <h4 class="widget-title">For Candidates</h4>
                  <div class="widget-content">
                    <ul class="list">
                      <li><a href="jobs.html">Browse Jobs</a></li>
                      <li><a href="candidate-dashboard-resume.html">upload Resume</a></li>
                      <li><a href="candidate-dashboard.html">Find companies</a></li>
                      <li><a href="candidate-dashboard-job-alerts.html">Job Alerts</a></li>
                    </ul>
                  </div>
                </div>
              </div>


              <div class="footer-column col-lg-3 col-md-6 col-sm-12">
                <div class="footer-widget links-widget">
                  <h4 class="widget-title">For Employers</h4>
                  <div class="widget-content">
                    <ul class="list">
                      <li><a href="login.html">Employer login</a></li>
                      <li><a href="dashboard-post-job.html">Job posting</a></li>
                      <li><a href="#">Discover Talent</a></li>
                      <li><a href="dashboard-packages.html">Packages</a></li>
                    </ul>
                  </div>
                </div>
              </div>

              <div class="footer-column col-lg-3 col-md-6 col-sm-12">
                <div class="footer-widget links-widget">
                  <h4 class="widget-title">About Us</h4>
                  <div class="widget-content">
                    <ul class="list">
                      <li><a href="about.html">About</a></li>
                      <li><a href="contact.html">Contact</a></li>
                      <li><a href="faqs.html">FAQ</a></li>
                    </ul>
                  </div>
                </div>
              </div>


              <div class="footer-column col-lg-3 col-md-6 col-sm-12">
                <div class="footer-widget links-widget">
                  <h4 class="widget-title">Upskills</h4>
                  <div class="widget-content">
                    <ul class="list">
                      <li><a href="courses-allcourse.html">All courses</a></li>
                      <li><a href="course-enrolled.html">My courses </a></li>
                      <li><a href="completedcourses.html">Completed Courses</a></li>
                      <li><a href="SkillAssesmentdashboard.html">Skill Assessment</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!--Bottom-->
    <div class="footer-bottom">
      <div class="auto-container">
        <div class="outer-box">
          <div class="copyright-text">
            © 2024 <a href="#">VTA</a>. All Right Reserved.
          </div>
          <div class="social-links">
            <a href="#"><i class="fab fa-facebook-f"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-linkedin-in"></i></a>
          </div>
        </div>
      </div>
    </div>

    <!-- Scroll To Top -->
    <div class="scroll-to-top scroll-to-target" data-target="html">
      <span class="fa fa-angle-up"></span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/jquery.js"></script>
  <script src="js/popper.min.js"></script>
  <script src="js/chosen.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery-ui.min.js"></script>
  <script src="js/jquery.fancybox.js"></script>
  <script src="js/jquery.modal.min.js"></script>
  <script src="js/mmenu.polyfills.js"></script>
  <script src="js/mmenu.js"></script>
  <script src="js/appear.js"></script>
  <script src="js/ScrollMagic.min.js"></script>
  <script src="js/rellax.min.js"></script>
  <script src="js/owl.js"></script>
  <script src="js/wow.js"></script>
  <script src="js/script.js"></script>
  <!--Google Map APi Key-->
  <script src="http://maps.google.com/maps/api/js?key=AIzaSyDaaCBm4FEmgKs5cfVrh3JYue3Chj1kJMw&#038;ver=5.2.4"></script>
  <script src="js/map-script.js"></script>
  <!--End Google Map APi-->
</body>

</html>